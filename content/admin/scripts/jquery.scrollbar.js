(function($){var $bar="ui-scrollbar",$wrap=$bar+"-container",$drag=$bar+"-drag",$leftcap=$drag+"-left",$rightcap=$drag+"-right",$button=$bar+"-button",$left=$bar+"-left",$right=$bar+"-right",$top=$bar+"-top",$bottom=$bar+"-bottom",$content=$bar+"-content",$disabled=$bar+"-disabled";var HTML={WRAP:'<div class="'+$wrap+'"></div>',BUTTONS:'<div class="'+$bar+'-button-wrap"><a href="#"></a></div><div class="'+$bar+'-button-wrap"><a href="#"></a></div>',BAR:'<div class="'+$bar+'"><span class="'+$drag+'"><span class="'+$leftcap+'"></span><span class="'+$rightcap+'"></span></span></div>'};var WIN=$(window),DOC=$(document),o,mouseUpTimer,trueTimer,globalProp;var $settings;var setOrient=function(type){var vert=(type=="vertical");return{vert:vert,prop:(vert)?"top":"left",scrollDir:(vert)?"scrollTop":"scrollLeft",dimension:(vert)?"height":"width",trueDimension:(vert)?"trueHeight":"trueWidth"};};var setDragDimensions=function(drag,el){var dimensions=el.data("dimensions");var viewport={height:Math.floor((dimensions.height/dimensions.trueHeight)*100),width:Math.floor((dimensions.width/dimensions.trueWidth)*100)};var height=(viewport.height>$settings.minHeight)?viewport.height:$settings.minHeight,width=(viewport.width>$settings.minWidth)?viewport.width:$settings.minWidth;var percent={top:(el.scrollTop()/dimensions.trueHeight)*100,left:(el.scrollLeft()/dimensions.trueWidth)*100};var parent=drag.parent().parent();if((width>=100)&&(height>=100)){parent.addClass($disabled);}else if(parent.hasClass($disabled)){parent.removeClass($disabled);}
drag.css({width:width+"%",height:height+"%",top:percent.top+"%",left:percent.left+"%"});};var setContainerDimensions=function(container,el,scrollbar,type){var props=["margin-left","margin-top","margin-right","margin-bottom","padding-left","padding-top","padding-right","padding-bottom"];for(var i=0,j=props.length;i<j;i++){var prop=props[i];container.css(prop,el.css(prop));el.css(prop,"0");}
container.css("float",el.css("float"));el.css("float","none");};var renderScrollbar=function(el,type){var vert=(type=="vertical"),target=el;var isRendered=target.data("isRendered"),html;if(!isRendered){target.wrap('<div class="'+$content+'"></div>').parent().wrap(HTML.WRAP);if((typeof $settings.buttons==="undefined")||($settings.buttons!==false)){var buttons=$(HTML.BUTTONS);var links=buttons.find("a").addClass($button);buttons.eq(0).addClass(vert?$top:$left);buttons.eq(1).addClass(vert?$bottom:$right);buttons.appendTo(target.parents("."+$wrap));target.data("isRendered",true);}}
html=target.closest("."+$wrap);var scrollbar=$(HTML.BAR).addClass($bar+"-"+type),drag=scrollbar.find("."+$drag);setDragDimensions(drag,target);setContainerDimensions(html,target,scrollbar,type);(vert)?scrollbar.appendTo(html):scrollbar.prependTo(html);bindEvents(target,type,html,scrollbar);};var bindEvents=function(el,type,html,scrollbar){for(var key in events){events[key](el,type,html,scrollbar);}};var animateScroll=function(options){var el=options.el,handle=options.handle,settings=options.settings,timer=options.timer,easing=options.easing||$settings.easing,handleWidth=handle.width(),parentWidth=handle.parent().width(),dimensions=el.data("dimensions");stopAnimation(el,handle);el.data("animating",options.type||true);el.animate(settings,{duration:timer,easing:easing,step:function(e){var left=handle.position().left,offset=handleWidth+left;if(e!==0){var percent=(e/dimensions[o.trueDimension])*100;if(!globalProp&&(parentWidth-offset)<=10){handle.css(o.prop,left+(parentWidth-offset));}else{handle.css(o.prop,(percent)+"%");}}},complete:function(){el.removeData("animating");if(options.complete){options.complete();}}});};var stopAnimation=function(el,handle){if(el.data("animating")){el.stop();handle.stop();el.removeData("animating");}};var sharedEvents={mousedown:function(e,el,handle,scroll,oEvt){var dimensions=el.data("dimensions");scroll=scroll||((globalProp)?0:(dimensions[o.trueDimension]-dimensions[o.dimension]));var options={};if(o.vert){options.scrollTop=scroll;}else{options.scrollLeft=scroll;}
var curr=el[o.scrollDir]();var diff=(scroll<curr)?(curr-scroll):(scroll-curr);var percent=(diff/dimensions[o.trueDimension]);if(oEvt&&oEvt.duration){trueTimer=oEvt.duration*percent;}else{trueTimer=$settings.scrollSpeed*percent;trueTimer=(trueTimer<$settings.minTimer)?$settings.minTimer:trueTimer;}
if(el[o.scrollDir]()!=scroll){mouseUpTimer=new Date().getTime();animateScroll({el:el,handle:handle,settings:options,timer:trueTimer,type:"mousedown",easing:(oEvt&&oEvt.easing)?oEvt.easing:null,complete:function(){if(oEvt&&oEvt.complete){oEvt.complete.call(el,globalProp);}}});}},mouseup:function(el,handle){if(el.data("animating")&&el.data("animating")=="mousedown"){var elapsedTime=new Date().getTime()-mouseUpTimer,remainingTime=(trueTimer-elapsedTime);var options={};var minTime=750;if(o.vert){options.scrollTop=Math.max(el.scrollTop()+((globalProp)?-minTime:minTime),0);}else{options.scrollLeft=Math.max(el.scrollLeft()+((globalProp)?-minTime:minTime),0);}
animateScroll({el:el,handle:handle,settings:options,timer:remainingTime,type:"mouseup",easing:$settings.easing?$settings.easing.replace(/[In]+/i,""):null});}},mouseout:function(el){if(el.data("animating")){$(this).trigger("mouseup");}}};var events={button:function(el,type,html,scrollbar){var links=html.find("."+$button),handle=scrollbar.find("."+$drag),dimensions=el.data("dimensions");o=setOrient(type);links.click(function(e){e.preventDefault();});links.bind("contextmenu",function(e){e.preventDefault();});links.mousedown(function(e){e.preventDefault();e.stopPropagation();var parent=$(this).parent();globalProp=parent.hasClass($left)||parent.hasClass($top);o=setOrient(type);sharedEvents.mousedown(e,el,handle,globalProp,e.originalEvent);});links.mouseup(function(e){e.preventDefault();e.stopPropagation();sharedEvents.mouseup(el,handle);});links.mouseout(function(e){e.preventDefault();e.stopPropagation();sharedEvents.mouseout(el);});},click:function(el,type,html,scrollbar){var evt=$.scrollbar.events[el.data("scrollbarID")],links=html.find("."+$button),o=setOrient(el);if(evt&&evt.onclick){links.bind("click",function(e){evt.onclick.call(el,e,$(this),html);});}},scroll:function(el,type,html,scrollbar){var evt=$.scrollbar.events[el.data("scrollbarID")],o=setOrient(el);if(evt&&evt.onscroll){el.bind("scroll",function(e){evt.onscroll.call(el,e,el[o.scrollDir](),html);});}},drag:function(el,type,html,scrollbar){o=setOrient(type);var content=el,container=html,parent=scrollbar,handle=scrollbar.find("."+$drag),dimensions=el.data("dimensions"),parentDimension=parent[o.dimension]();var startY,offsetY,startX,offsetX,diff;var mousemove=function(e){e.preventDefault();var value,setting,percent,start,end,remainder,scrollValue,i;parentDimension=parent[o.dimension]();setting=(parentDimension-handle[o.dimension]());stasis=el.data("dimensions")[o.trueDimension];value=(o.vert)?(offsetY+e.pageY-startY):(offsetX+e.pageX-startX);start=parseFloat(handle.css(o.prop));end=handle.position()[o.prop];if((value>0)&&(value<setting)){percent=(value/parentDimension)*100;handle.css(o.prop,percent+"%");scrollValue=stasis*(percent/100);}else if(value<0&&start){handle.css(o.prop,0+"%");scrollValue=0+"%";}else if((value>end)&&(end!=setting)){remainder=(setting-end);percent=(remainder/parentDimension)*100;handle.css(o.prop,parseFloat(handle.css(o.prop))+percent+"%");scrollValue=stasis;}
if(typeof scrollValue!=="undefined"){el[o.scrollDir](scrollValue);}};scrollbar.click(function(e){e.preventDefault();});scrollbar.bind("contextmenu",function(e){e.preventDefault();});scrollbar.mousedown(function(e){e.preventDefault();o=setOrient(type);var valueAxis;if(o.vert){valueAxis=(e.pageY);}else{valueAxis=(e.pageX);}
var currProp=handle.offset()[o.prop];globalProp=(valueAxis<currProp);var coord=(valueAxis-scrollbar.offset()[o.prop]),percent=(coord/(scrollbar[o.dimension]())),scrollValue=(dimensions[o.trueDimension]-dimensions[o.dimension])*percent;sharedEvents.mousedown(e,el,handle,scrollValue);});scrollbar.mouseup(function(){sharedEvents.mouseup(el,handle);});scrollbar.mouseout(function(){sharedEvents.mouseout(el);});handle.mousedown(function(e){e.stopPropagation();e.preventDefault();stopAnimation(el,handle);var pos=$(this).position();if(o.vert){startY=e.pageY;offsetY=pos.top;}else{startX=e.pageX;offsetX=pos.left;}
DOC.mousemove(mousemove);});handle.mouseup(function(e){if(el.data("animating")){e.stopPropagation();}});DOC.mouseup(function(){DOC.unbind("mousemove",mousemove);});},mousewheel:function(el,type,html,scrollbar){o=setOrient(type);var content=el,container=html,parent=html.find("."+$content),handle=scrollbar.find("."+$drag);container.bind("wheel",function(e,delta){var speed=$.browser.safari?$settings.wheelSpeed:($settings.wheelSpeed*3);var value=(delta*speed);if(delta!==0){content[o.scrollDir](content[o.scrollDir]()-value);}
var percent=(content[o.scrollDir]()/el.data("dimensions")[o.trueDimension])*100;handle.css(o.prop,(percent)+"%");var old=handle.data("oldPercent");if(old&&(percent!=old)){e.preventDefault();}else{handle.css(o.prop,Math.ceil(parseFloat(handle.css(o.prop)))+"%");}
handle.data("oldPercent",percent.toString());});},textresize:function(el){if($.onTextResize){DOC.bind("textresize",function(){$.scrollbar.redraw(el);});}}};var resetDimensions=function(el){var dimensions=getTrueDimensions(el);el.data("dimensions",dimensions);return dimensions;};var getTrueDimensions=function(el){var scrollbar=el.closest("."+$bar);var height,width,trueHeight,trueWidth,oTop,oLeft,farScroll=9999999;height=el.height();width=el.width();oTop=el.scrollTop();oLeft=el.scrollLeft();var target=el.css("visibility","hidden");scrollbar.hide();target.scrollTop(farScroll).scrollLeft(farScroll);trueHeight=(target.scrollTop()+el.height());trueWidth=(target.scrollLeft()+el.width());target.scrollTop(oTop).scrollLeft(oLeft);target.css("visibility","");scrollbar.show();return{top:oTop,left:oLeft,height:height,width:width,trueHeight:trueHeight,trueWidth:trueWidth};};$.scrollbar={counter:0,elements:[],events:{},redraw:function(els){if(els&&typeof els==="string"){els=$(els);}
els=els||$($.scrollbar.elements);els.each(function(){var el=$(this),wrap=el.closest("."+$wrap),drag=wrap.find("."+$drag);resetDimensions(el);setDragDimensions(drag,el);});return els;}};$.fn.scrollbar=function(options){return this.filter(function(){return!$(this).closest("."+$wrap).get(0);}).each(function(){$settings=$.extend({},$.fn.scrollbar.defaults,options);var node=this,el=$(node),width,height,dimensions,trueWidth,trueHeight;el.data("scrollbarID",++($.scrollbar.counter));var sID=el.data("scrollbarID");if($settings&&$settings.onscroll){$.scrollbar.events[sID]=$.scrollbar.events[sID]||{};$.scrollbar.events[sID].onscroll=$settings.onscroll;}
if($settings&&$settings.onclick){$.scrollbar.events[sID].onclick=$settings.onclick;}
el.css("overflow","hidden");dimensions=resetDimensions(el);height=dimensions.height;width=dimensions.width;trueHeight=dimensions.trueHeight;trueWidth=dimensions.trueWidth;if(width!=trueWidth){renderScrollbar(el,"horizontal");}
$.scrollbar.elements.push(this);});};$.fn.scrollTo=function(value,duration){var parent=this.closest("."+$wrap),handle=parent.find("."+$drag);var options={};if(o.vert){options.scrollTop=value;}else{options.scrollLeft=value;}
animateScroll({el:this,handle:handle,settings:options,timer:duration||1000,easing:$settings.easing.replace(/[In]+/i,"")});};$.fn.scrollbar.defaults={minWidth:10,minHeight:100,scrollSpeed:1000,minTimer:1500,wheelSpeed:6,easing:null};})(jQuery);